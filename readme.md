# Malex-Bot

## Описание функционала
При старе бот запрашивает сообщения из указнных в канфиге чатов. 
Из полученных сообщений сохраняет в бд те которые содержат нужную подстроку, 
но но ещё не сохранены (например на случай если бот был не активен какоето время).

На этом первый скрипт прекращает работу и запускается второй 
который слушает по вэбсокету события из указанного маттермоста и прогоняет их через 
процессоры соответствующие типам событий.

Процессры описаны в 'core.messengers.mattermost.event_processors'

_На данный моемент реализованы сохранения сообщений и логирование подключившихся к сокету_ 



# Настройка Mattermost
1) Создать бота
2) Получить токен бота и прокинуть в данное ПО

# Описание параметров

## блок backend:
    host: "0.0.0.0" - ip который будет слушать Nginx
    port: 8765      - порт на котором работает сервис

## блок db:
    username: ""    - имя пользователя БД
    password: ""    - пароль к БД
    name: ""        - имя БД                    -
    host: ""        - хост контейнера (localhost, etc...)
    port:           - порт БД
    host_test: ""   - хост БД для тестов (проброс БД из докера через localhost)
    port_test:      - порт БД для тестов (проброс БД из докера через localhost)

## блок mattermost:
    http_host: "wss://{mattermost_host}/api/v4/websocket"   # сервер где хостится mattermost
    api_location: "/api/v4/"                                # роут апи
    ws_host: "wss://{mattermost_host}"                      # хост для подключения по протоколу wss
    ws_api_location: "/api/v4/websocket"                    # роут ws апи
    token: ""                                               # токен для работы с mattermost
    id: ""                                                  # login_id пользователя mattermost(mattermost_bot)                           
    test_channel_id: "test_channel_id"                       
    filter_messages_contains: "some_substring"              # Подстрока по которой слледует фильтровать сообщения
    listen_channels:                                        # Список каналов которые сообщения в которых надо слушать
      - "some_channel_id_1"
      - "some_channel_id_2"
    target_events_processors:                               # События прилетающие из ws mmost на которые надо реагировать
      - hello:
        - "log"
      - posted:                                             # Тип события
         - "save"                                           # Тип процессора для событий этого типа        
         - "response"